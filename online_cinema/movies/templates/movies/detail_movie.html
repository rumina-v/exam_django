{% extends 'movies/base.html' %}

{% block title %}{{ movie.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        {% if movie.poster %}
        <img src="{{ movie.poster.url }}" class="img-fluid" alt="{{ movie.title }}">
        {% endif %}
    </div>
    <div class="col-md-8">
        <h2>{{ movie.title }}</h2>
        <p><strong>Режиссёр:</strong> {{ movie.director }}</p>
        <p><strong>Жанр:</strong> {{ movie.genre }}</p>
        <p><strong>Год:</strong> {{ movie.year }}</p>
        <p><strong>Добавлен:</strong> {{ movie.created_at|date:"d.m.Y H:i" }}</p>
    </div>
</div>

<hr>

<!-- Отзывы -->
<h3>Отзывы</h3>
{% for review in reviews %}
<div class="card mb-3">
    <div class="card-body">
        <h5 class="card-title">{{ review.user.username }}</h5>
        <p class="card-text"><strong>Рейтинг:</strong> {{ review.rating }}/5</p>
        <p class="card-text">{{ review.text|linebreaks }}</p>
        <small class="text-muted">{{ review.created_at|date:"d.m.Y H:i" }}</small>
    </div>
</div>
{% empty %}
<p>Пока нет отзывов.</p>
{% endfor %}

<!-- Форма добавления отзыва -->
{% if user.is_authenticated %}
<h4>Оставить отзыв</h4>
<form method="post" action="{% url 'reviews:add_review' movie.id %}">
    {% csrf_token %}
    <div class="mb-3">
        <label for="id_text" class="form-label">Текст отзыва</label>
        <textarea name="text" class="form-control" id="id_text" rows="3"></textarea>
    </div>
    <div class="mb-3">
        <label for="id_rating" class="form-label">Рейтинг</label>
        <select name="rating" class="form-select" id="id_rating">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Оставить отзыв</button>
</form>
{% else %}
<p><a href="{% url 'login' %}">Войдите</a>, чтобы оставить отзыв.</p>
{% endif %}
{% endblock %}